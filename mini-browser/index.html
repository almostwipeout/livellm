<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quad Browser</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700;900&family=Roboto+Mono:wght@300;400&display=swap');

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body, html {
      height: 100%;
      overflow: hidden;
      background: #0a0a12;
      color: #0ff;
      font-family: 'Orbitron', sans-serif;
    }

    header {
      height: 44px;
      background: rgba(0,20,40,0.95);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid #0ff3;
      display: flex;
      align-items: center;
      padding: 0 16px;
      gap: 16px;
    }

    .header-title {
      font-size: 1.1rem;
      font-weight: 700;
      color: #0ff;
      text-shadow: 0 0 10px #0ff8;
      letter-spacing: 2px;
    }

    .layout-toggle {
      margin-left: auto;
      display: flex;
      gap: 6px;
    }

    .layout-btn {
      background: #001122;
      border: 1px solid #0ff4;
      color: #0ff;
      padding: 6px 12px;
      border-radius: 4px;
      cursor: pointer;
      font-family: 'Roboto Mono', monospace;
      font-size: 0.75rem;
      transition: all 0.3s;
    }

    .layout-btn:hover, .layout-btn.active {
      background: #0ff;
      color: #000;
      box-shadow: 0 0 12px #0ff8;
    }

    #grid-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      grid-template-rows: 1fr 1fr;
      height: calc(100vh - 44px);
      gap: 2px;
      padding: 2px;
      background: #000;
    }

    #grid-container.layout-2 {
      grid-template-columns: 1fr 1fr;
      grid-template-rows: 1fr;
    }

    #grid-container.layout-2 .quadrant:nth-child(3),
    #grid-container.layout-2 .quadrant:nth-child(4) {
      display: none;
    }

    #grid-container.layout-1 {
      grid-template-columns: 1fr;
      grid-template-rows: 1fr;
    }

    #grid-container.layout-1 .quadrant:nth-child(2),
    #grid-container.layout-1 .quadrant:nth-child(3),
    #grid-container.layout-1 .quadrant:nth-child(4) {
      display: none;
    }

    .quadrant {
      position: relative;
      background: #0a1020;
      border: 1px solid #0ff2;
      border-radius: 4px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .quadrant:focus-within {
      border-color: #0ff;
      box-shadow: 0 0 20px #0ff4;
    }

    .quad-nav {
      height: 38px;
      background: rgba(0,10,20,0.95);
      display: flex;
      padding: 4px 8px;
      gap: 6px;
      border-bottom: 1px solid #0ff2;
    }

    .quad-url {
      flex: 1;
      background: #001525;
      border: 1px solid #0ff3;
      color: #0ff;
      padding: 0 10px;
      border-radius: 4px;
      font-family: 'Roboto Mono', monospace;
      font-size: 0.85rem;
      transition: all 0.3s;
    }

    .quad-url:focus {
      outline: none;
      box-shadow: 0 0 10px #0ff6;
      border-color: #0ff;
    }

    .quad-url::placeholder {
      color: #0ff6;
    }

    .quad-go {
      background: linear-gradient(135deg, #0ff, #08f);
      color: #000;
      border: none;
      padding: 0 14px;
      border-radius: 4px;
      font-weight: bold;
      font-size: 0.75rem;
      cursor: pointer;
      transition: all 0.3s;
      font-family: 'Orbitron', sans-serif;
    }

    .quad-go:hover {
      transform: scale(1.05);
      box-shadow: 0 0 15px #0ff;
    }

    .zoom-controls {
      display: flex;
      gap: 2px;
    }

    .zoom-btn {
      width: 26px;
      height: 26px;
      background: #001525;
      border: 1px solid #0ff3;
      color: #0ff;
      border-radius: 4px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .zoom-btn:hover {
      background: #0ff;
      color: #000;
    }

    .quad-content {
      flex: 1;
      position: relative;
      background: #fff;
    }

    webview {
      width: 100%;
      height: 100%;
      border: none;
    }

    .quad-placeholder {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #0a1020 0%, #0a0a18 100%);
      color: #0ff8;
      font-size: 0.9rem;
    }

    .quad-placeholder-icon {
      font-size: 3rem;
      margin-bottom: 12px;
      opacity: 0.5;
    }

    .quad-number {
      position: absolute;
      top: 6px;
      right: 8px;
      font-size: 0.65rem;
      color: #0ff4;
      font-family: 'Roboto Mono', monospace;
    }

    .quad-zoom {
      position: absolute;
      bottom: 6px;
      left: 8px;
      font-size: 0.6rem;
      color: #0ff6;
      font-family: 'Roboto Mono', monospace;
      background: rgba(0,0,0,0.5);
      padding: 2px 6px;
      border-radius: 3px;
    }

    .quad-coords {
      position: absolute;
      bottom: 6px;
      right: 8px;
      font-size: 0.55rem;
      color: #0ff4;
      font-family: 'Roboto Mono', monospace;
      background: rgba(0,0,0,0.5);
      padding: 2px 6px;
      border-radius: 3px;
    }

    .quadrant.focused {
      border-color: #0ff;
      box-shadow: 0 0 25px #0ff6;
    }

    .zoom-toast {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0,255,255,0.9);
      color: #000;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 1.2rem;
      font-weight: bold;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.2s;
      z-index: 9999;
    }

    .zoom-toast.show {
      opacity: 1;
    }

    .settings-btn {
      background: #001122;
      border: 1px solid #0ff4;
      color: #0ff;
      padding: 6px 12px;
      border-radius: 4px;
      cursor: pointer;
      font-family: 'Roboto Mono', monospace;
      font-size: 0.75rem;
      transition: all 0.3s;
      margin-left: 12px;
    }

    .settings-btn:hover {
      background: #0ff;
      color: #000;
    }

    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.8);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 10000;
    }

    .modal-overlay.show {
      display: flex;
    }

    .modal {
      background: #0a1525;
      border: 1px solid #0ff;
      border-radius: 12px;
      padding: 24px;
      width: 500px;
      max-width: 90vw;
      box-shadow: 0 0 40px #0ff4;
    }

    .modal h2 {
      color: #0ff;
      margin-bottom: 20px;
      font-size: 1.2rem;
      text-shadow: 0 0 10px #0ff8;
    }

    .modal-row {
      display: flex;
      align-items: center;
      margin-bottom: 12px;
      gap: 12px;
    }

    .modal-row label {
      width: 30px;
      color: #0ff8;
      font-size: 0.85rem;
    }

    .modal-row input {
      flex: 1;
      background: #001525;
      border: 1px solid #0ff3;
      color: #0ff;
      padding: 8px 12px;
      border-radius: 4px;
      font-family: 'Roboto Mono', monospace;
      font-size: 0.85rem;
    }

    .modal-row input:focus {
      outline: none;
      border-color: #0ff;
      box-shadow: 0 0 10px #0ff6;
    }

    .modal-buttons {
      display: flex;
      gap: 12px;
      margin-top: 20px;
      justify-content: flex-end;
    }

    .modal-btn {
      padding: 8px 20px;
      border-radius: 4px;
      font-family: 'Orbitron', sans-serif;
      font-size: 0.8rem;
      cursor: pointer;
      transition: all 0.3s;
    }

    .modal-btn.save {
      background: linear-gradient(135deg, #0ff, #08f);
      color: #000;
      border: none;
      font-weight: bold;
    }

    .modal-btn.save:hover {
      box-shadow: 0 0 15px #0ff;
    }

    .modal-btn.cancel {
      background: transparent;
      border: 1px solid #0ff4;
      color: #0ff;
    }

    .modal-btn.cancel:hover {
      background: #0ff2;
    }
  </style>
</head>
<body>
  <header>
    <span class="header-title">QUAD BROWSER</span>
    <div class="layout-toggle">
      <button class="layout-btn" data-layout="1">1</button>
      <button class="layout-btn" data-layout="2">2</button>
      <button class="layout-btn active" data-layout="4">4</button>
    </div>
    <button class="settings-btn" id="settingsBtn">SETTINGS</button>
  </header>

  <div id="grid-container">
    <div class="quadrant" data-quadrant="1">
      <div class="quad-nav">
        <input type="text" class="quad-url" placeholder="URLを入力...">
        <button class="quad-go">GO</button>
        <div class="zoom-controls">
          <button class="zoom-btn zoom-out">-</button>
          <button class="zoom-btn zoom-in">+</button>
        </div>
      </div>
      <div class="quad-content">
        <webview></webview>
      </div>
      <span class="quad-number">#1 GPT</span>
      <span class="quad-zoom">50%</span>
      <span class="quad-coords"></span>
    </div>

    <div class="quadrant" data-quadrant="2">
      <div class="quad-nav">
        <input type="text" class="quad-url" placeholder="URLを入力...">
        <button class="quad-go">GO</button>
        <div class="zoom-controls">
          <button class="zoom-btn zoom-out">-</button>
          <button class="zoom-btn zoom-in">+</button>
        </div>
      </div>
      <div class="quad-content">
        <webview></webview>
      </div>
      <span class="quad-number">#2 Gemini</span>
      <span class="quad-zoom">50%</span>
      <span class="quad-coords"></span>
    </div>

    <div class="quadrant" data-quadrant="3">
      <div class="quad-nav">
        <input type="text" class="quad-url" placeholder="URLを入力...">
        <button class="quad-go">GO</button>
        <div class="zoom-controls">
          <button class="zoom-btn zoom-out">-</button>
          <button class="zoom-btn zoom-in">+</button>
        </div>
      </div>
      <div class="quad-content">
        <webview></webview>
      </div>
      <span class="quad-number">#3 Claude</span>
      <span class="quad-zoom">50%</span>
      <span class="quad-coords"></span>
    </div>

    <div class="quadrant" data-quadrant="4">
      <div class="quad-nav">
        <input type="text" class="quad-url" placeholder="URLを入力...">
        <button class="quad-go">GO</button>
        <div class="zoom-controls">
          <button class="zoom-btn zoom-out">-</button>
          <button class="zoom-btn zoom-in">+</button>
        </div>
      </div>
      <div class="quad-content">
        <webview></webview>
      </div>
      <span class="quad-number">#4 Grok</span>
      <span class="quad-zoom">50%</span>
      <span class="quad-coords"></span>
    </div>
  </div>

  <div class="zoom-toast" id="zoomToast"></div>

  <!-- 設定モーダル -->
  <div class="modal-overlay" id="modalOverlay">
    <div class="modal">
      <h2>初期URL設定</h2>
      <div class="modal-row">
        <label>#1</label>
        <input type="text" id="url1" placeholder="https://...">
      </div>
      <div class="modal-row">
        <label>#2</label>
        <input type="text" id="url2" placeholder="https://...">
      </div>
      <div class="modal-row">
        <label>#3</label>
        <input type="text" id="url3" placeholder="https://...">
      </div>
      <div class="modal-row">
        <label>#4</label>
        <input type="text" id="url4" placeholder="https://...">
      </div>
      <div class="modal-buttons">
        <button class="modal-btn cancel" id="cancelBtn">CANCEL</button>
        <button class="modal-btn save" id="saveBtn">SAVE & RELOAD</button>
      </div>
    </div>
  </div>

  <script>
    const gridContainer = document.getElementById('grid-container');
    const layoutBtns = document.querySelectorAll('.layout-btn');
    const zoomToast = document.getElementById('zoomToast');
    const settingsBtn = document.getElementById('settingsBtn');
    const modalOverlay = document.getElementById('modalOverlay');
    const saveBtn = document.getElementById('saveBtn');
    const cancelBtn = document.getElementById('cancelBtn');

    // デフォルトURL
    const defaultUrls = {
      1: 'https://chatgpt.com',
      2: 'https://gemini.google.com',
      3: 'https://claude.ai',
      4: 'https://grok.com'
    };

    // localStorageから読み込み、なければデフォルト
    function getUrls() {
      const saved = localStorage.getItem('quadUrls');
      return saved ? JSON.parse(saved) : { ...defaultUrls };
    }

    // 各パネルのズームレベル（初期値50%）
    const zoomLevels = { 1: 0.5, 2: 0.5, 3: 0.5, 4: 0.5 };
    const DEFAULT_ZOOM = 0.5;
    let focusedQuadrant = null;

    // ズームトースト表示
    function showZoomToast(level) {
      zoomToast.textContent = Math.round(level * 100) + '%';
      zoomToast.classList.add('show');
      setTimeout(() => zoomToast.classList.remove('show'), 500);
    }

    // 座標更新（AHK用 - スクリーン絶対座標）
    function updateCoords() {
      // Electronウィンドウのスクリーン位置を取得
      const screenX = window.screenX || 0;
      const screenY = window.screenY || 0;

      document.querySelectorAll('.quadrant').forEach(quad => {
        const rect = quad.getBoundingClientRect();
        const coordsEl = quad.querySelector('.quad-coords');
        // スクリーン絶対座標に変換
        const cx = Math.round(screenX + rect.left + rect.width / 2);
        const cy = Math.round(screenY + rect.top + rect.height / 2);
        const rx = Math.round(screenX + rect.right);
        const ry = Math.round(screenY + rect.bottom);
        coordsEl.textContent = `中央(${cx},${cy}) 右下(${rx},${ry})`;
      });
    }

    // 定期的に座標更新（ウィンドウ移動対応）
    setInterval(updateCoords, 500);

    // 設定モーダル
    settingsBtn.addEventListener('click', () => {
      const urls = getUrls();
      document.getElementById('url1').value = urls[1];
      document.getElementById('url2').value = urls[2];
      document.getElementById('url3').value = urls[3];
      document.getElementById('url4').value = urls[4];
      modalOverlay.classList.add('show');
    });

    cancelBtn.addEventListener('click', () => {
      modalOverlay.classList.remove('show');
    });

    saveBtn.addEventListener('click', () => {
      const urls = {
        1: document.getElementById('url1').value.trim() || defaultUrls[1],
        2: document.getElementById('url2').value.trim() || defaultUrls[2],
        3: document.getElementById('url3').value.trim() || defaultUrls[3],
        4: document.getElementById('url4').value.trim() || defaultUrls[4]
      };
      localStorage.setItem('quadUrls', JSON.stringify(urls));
      modalOverlay.classList.remove('show');
      // リロードして反映
      location.reload();
    });

    // モーダル外クリックで閉じる
    modalOverlay.addEventListener('click', (e) => {
      if (e.target === modalOverlay) {
        modalOverlay.classList.remove('show');
      }
    });

    // レイアウト切り替え
    layoutBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        layoutBtns.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');

        const layout = btn.dataset.layout;
        gridContainer.className = '';
        if (layout !== '4') {
          gridContainer.classList.add('layout-' + layout);
        }
        setTimeout(updateCoords, 100);
      });
    });

    // 初期化：URLを読み込んでwebviewに設定
    function initQuadrants() {
      const urls = getUrls();
      document.querySelectorAll('.quadrant').forEach(quad => {
        const input = quad.querySelector('.quad-url');
        const goBtn = quad.querySelector('.quad-go');
        const webview = quad.querySelector('webview');
        const zoomEl = quad.querySelector('.quad-zoom');
        const quadId = parseInt(quad.dataset.quadrant);

        // 初期URL設定
        const initialUrl = urls[quadId];
        input.value = initialUrl;
        webview.src = initialUrl;

        // 初期ズーム50%を適用
        webview.addEventListener('dom-ready', () => {
          webview.setZoomFactor(DEFAULT_ZOOM);
          zoomEl.textContent = Math.round(DEFAULT_ZOOM * 100) + '%';
        });

        const navigate = () => {
          let url = input.value.trim();
          if (!url) return;

          if (!url.includes('.') || url.includes(' ')) {
            url = 'https://www.google.com/search?q=' + encodeURIComponent(url);
          } else if (!/^https?:\/\//i.test(url)) {
            url = 'https://' + url;
          }

          webview.src = url;
          input.value = url;
        };

        goBtn.addEventListener('click', navigate);
        input.addEventListener('keypress', e => {
          if (e.key === 'Enter') navigate();
        });

        webview.addEventListener('did-navigate', (e) => {
          input.value = e.url;
        });

        quad.addEventListener('click', () => {
          document.querySelectorAll('.quadrant').forEach(q => q.classList.remove('focused'));
          quad.classList.add('focused');
          focusedQuadrant = quadId;
        });

        quad.addEventListener('mouseenter', () => {
          focusedQuadrant = quadId;
        });

        // ズームボタン
        const zoomInBtn = quad.querySelector('.zoom-in');
        const zoomOutBtn = quad.querySelector('.zoom-out');

        const applyZoom = (delta) => {
          zoomLevels[quadId] = Math.max(0.25, Math.min(3, zoomLevels[quadId] + delta));
          webview.setZoomFactor(zoomLevels[quadId]);
          zoomEl.textContent = Math.round(zoomLevels[quadId] * 100) + '%';
          showZoomToast(zoomLevels[quadId]);
        };

        zoomInBtn.addEventListener('click', () => applyZoom(0.1));
        zoomOutBtn.addEventListener('click', () => applyZoom(-0.1));

        // Ctrl+ホイール（quadrantのパディング部分用）
        quad.addEventListener('wheel', (e) => {
          if (e.ctrlKey) {
            e.preventDefault();
            const delta = e.deltaY > 0 ? -0.1 : 0.1;
            applyZoom(delta);
          }
        }, { passive: false });
      });
    }

    // 初期化
    initQuadrants();

    window.addEventListener('load', () => {
      setTimeout(updateCoords, 500);
    });
    window.addEventListener('resize', updateCoords);
  </script>
</body>
</html>
